[
  {
    "cate": "prometheus",
    "datasource_queries": [
      {
        "match_type": 0,
        "op": "in",
        "values": [
          1
        ]
      }
    ],
    "name": "é‡‘æ²™æ±Ÿè·¯ StarRocks BE Compaction å¤±è´¥é¢‘ç¹",
    "note": "é‡‘æ²™æ±Ÿè·¯ StarRocks BE Cumulative Compaction å¤±è´¥æŠ¥è­¦\n\nå‘Šè­¦æè¿°:\n**ðŸ“Œ æ£€æµ‹æŒ‡æ ‡ä¿¡æ¯**  \nâ–¸ å®žä¾‹ï¼š`{{$labels.instance}}`  \nâ–¸ ç±»åž‹ï¼š`{{$labels.type}}`  \nâ–¸ å¤±è´¥æ¬¡æ•°ï¼š`{{$value}}`ï¼ˆæœ€è¿‘ 1 åˆ†é’Ÿï¼‰  \nâ–¸ è§¦å‘æ¡ä»¶ï¼šCompaction ç±»åž‹æ“ä½œå¤±è´¥æ¬¡æ•° > 3\n\n**ðŸ“ é—®é¢˜è¯´æ˜Ž**  \nâœ“ æœ€è¿‘ 1 åˆ†é’Ÿå†…ï¼Œå‡ºçŽ°äº† Cumulative æˆ– Base Compaction ç±»åž‹çš„å¤±è´¥æ“ä½œ  \nâœ“ å¯èƒ½ç”±äºŽæ•°æ®ç¢Žç‰‡ã€èµ„æºç“¶é¢ˆã€ç‰ˆæœ¬è¿‡å¤šæˆ–ç£ç›˜åŽ‹åŠ›å¯¼è‡´  \n\n**ðŸ›  å¤„ç†å»ºè®®**  \nè¯·ç™»å½•å¯¹åº” BE èŠ‚ç‚¹ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æŽ’æŸ¥å¼‚å¸¸ Tabletï¼š\ngrep -E 'compaction' be.INFO | grep failed",
    "prod": "metric",
    "delay": 0,
    "prom_for_duration": 30,
    "rule_config": {
      "queries": [
        {
          "prom_ql": "increase(starrocks_be_engine_requests_total{job=\"jsj-starrocks\", status=\"failed\", type=\"cumulative_compaction\"}[1m]) > 3\nor\nincrease(starrocks_be_engine_requests_total{job=\"jsj-starrocks\", status=\"failed\", type=\"base_compaction\"}[1m]) > 3",
          "severity": 2,
          "unit": "none"
        }
      ]
    },
    "event_relabel_config": null,
    "prom_eval_interval": 15,
    "enable_in_bg": 0,
    "notify_recovered": 1,
    "notify_repeat_step": 60,
    "notify_max_number": 0,
    "recover_duration": 0,
    "callbacks": [],
    "append_tags": [
      "project=jsj"
    ],
    "annotations": {},
    "uuid": 0,
    "cur_event_count": 0,
    "update_by_nickname": "è¶…ç®¡",
    "cron_pattern": "@every 30s",
    "notify_rule_ids": [
      1
    ],
    "notify_version": 1
  },
  {
    "cate": "prometheus",
    "datasource_queries": [
      {
        "match_type": 0,
        "op": "in",
        "values": [
          1
        ]
      }
    ],
    "name": "é‡‘æ²™æ±Ÿè·¯ StarRocks BE CPU ä½¿ç”¨çŽ‡è¿‡é«˜",
    "note": "é‡‘æ²™æ±Ÿè·¯ StarRocks BE å®žä¾‹ CPU ä½¿ç”¨çŽ‡è¿‡é«˜\n\n**ðŸ“Œ æ£€æµ‹æŒ‡æ ‡ä¿¡æ¯**  \nâ–¸ å®žä¾‹åœ°å€ï¼š`{{$labels.instance}}`  \nâ–¸ æ‰€å±ž Jobï¼š`{{$labels.job}}`  \nâ–¸ å½“å‰ CPU ä½¿ç”¨çŽ‡ï¼š`{{ printf \"%.2f\" $value }}%`  \nâ–¸ è§¦å‘æ¡ä»¶ï¼šCPU ä½¿ç”¨çŽ‡ > 90%\n\n**ðŸ“ å½±å“åˆ†æž**  \nâœ“ é«˜ CPU ä½¿ç”¨çŽ‡å¯èƒ½å¯¼è‡´ BE æŸ¥è¯¢ã€è®¡ç®—ä»»åŠ¡å“åº”å˜æ…¢  \nâœ“ å¦‚æžœæŒç»­è¿‡é«˜ï¼Œå¯èƒ½å¼•å‘ä»»åŠ¡é˜»å¡žã€æœåŠ¡å¼‚å¸¸ç­‰é—®é¢˜  \n\n**ðŸ› ï¸ å¤„ç†å»ºè®®**  \nâœ“ æ£€æŸ¥è¯¥ BE å®žä¾‹æ˜¯å¦å­˜åœ¨é‡è´Ÿè½½ SQLã€èµ„æºæŠ¢å ç­‰é—®é¢˜  \nâœ“ ä¼˜åŒ– SQL æŸ¥è¯¢æˆ–ä»»åŠ¡è°ƒåº¦ç­–ç•¥  \nâœ“ å¿…è¦æ—¶æ‰©å®¹ BE å®žä¾‹æˆ–æå‡èŠ‚ç‚¹èµ„æºé…é¢",
    "prod": "metric",
    "delay": 0,
    "prom_for_duration": 30,
    "rule_config": {
      "queries": [
        {
          "prom_ql": "(1-(sum(rate(starrocks_be_cpu{mode=\"idle\", job=\"jsj-starrocks\",instance=~\".*\"}[5m])) by (job, instance)) / (sum(rate(starrocks_be_cpu{job=\"jsj-starrocks\",host=~\".*\"}[5m])) by (job, instance))) * 100 > 90",
          "severity": 2,
          "unit": "none"
        }
      ]
    },
    "event_relabel_config": null,
    "prom_eval_interval": 15,
    "enable_in_bg": 0,
    "notify_recovered": 1,
    "notify_repeat_step": 60,
    "notify_max_number": 0,
    "recover_duration": 0,
    "callbacks": [],
    "append_tags": [
      "project=jsj"
    ],
    "annotations": {},
    "uuid": 0,
    "cur_event_count": 0,
    "update_by_nickname": "è¶…ç®¡",
    "cron_pattern": "@every 30s",
    "notify_rule_ids": [
      1
    ],
    "notify_version": 1
  },
  {
    "cate": "prometheus",
    "datasource_queries": [
      {
        "match_type": 0,
        "op": "in",
        "values": [
          1
        ]
      }
    ],
    "name": "é‡‘æ²™æ±Ÿè·¯ StarRocks BE Tablet Rowset æ•°è¿‡é«˜",
    "note": "é‡‘æ²™æ±Ÿè·¯  StarRocks BE Tablet ç‰ˆæœ¬ä¸ªæ•°è¶…é™åˆ¶æŠ¥è­¦\n\n**ðŸ“Œ æ£€æµ‹æŒ‡æ ‡ä¿¡æ¯**  \nâ–¸ å®žä¾‹åœ°å€ï¼š`{{$labels.instance}}`  \nâ–¸ å½“å‰æœ€å¤§ Tablet Rowset æ•°ï¼š`{{$value}}`  \nâ–¸ è§¦å‘æ¡ä»¶ï¼šBE èŠ‚ç‚¹ä¸ŠæŸä¸ª Tablet çš„ Rowset æ•°è¶…è¿‡ 700ï¼Œè¯´æ˜Žåˆå¹¶æœªåŠæ—¶è¿›è¡Œ\n\n**ðŸ“ é—®é¢˜è¯´æ˜Ž**  \nâœ“ Rowset ä»£è¡¨ä¸€ä¸ªæ•°æ®ç‰ˆæœ¬ï¼Œæ•°é‡å¼‚å¸¸è¯´æ˜Ž Tablet é•¿æ—¶é—´æœªè¢« Compaction  \nâœ“ é«˜ Rowset æ•°å¯èƒ½ä¼šå½±å“æŸ¥è¯¢æ€§èƒ½å¹¶åŠ é‡å­˜å‚¨è´Ÿæ‹…\n\n**ðŸ›  å¤„ç†å»ºè®®**  \n- æ£€æŸ¥è¯¥ BE èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ Compaction å¼‚å¸¸  \n- æŸ¥çœ‹ BE æ—¥å¿—ä¸­æ˜¯å¦æœ‰ compaction failed çš„é”™è¯¯  \n- é€šè¿‡ä»¥ä¸‹è¯­å¥æŸ¥çœ‹ç‰ˆæœ¬æ•°è¿‡å¤šçš„ Tablet\nSELECT BE_ID,TABLET_ID FROM information_schema.be_tablets WHERE NUM_ROWSET>700;",
    "prod": "metric",
    "delay": 0,
    "prom_for_duration": 30,
    "rule_config": {
      "queries": [
        {
          "prom_ql": "starrocks_be_max_tablet_rowset_num{job=\"jsj-starrocks\"} > 700",
          "severity": 2,
          "unit": "none"
        }
      ]
    },
    "event_relabel_config": null,
    "prom_eval_interval": 15,
    "enable_in_bg": 0,
    "notify_recovered": 1,
    "notify_repeat_step": 60,
    "notify_max_number": 0,
    "recover_duration": 0,
    "callbacks": [],
    "append_tags": [
      "project=jsj"
    ],
    "annotations": {},
    "uuid": 0,
    "cur_event_count": 0,
    "update_by_nickname": "è¶…ç®¡",
    "cron_pattern": "@every 30s",
    "notify_rule_ids": [
      1
    ],
    "notify_version": 1
  },
  {
    "cate": "prometheus",
    "datasource_queries": [
      {
        "match_type": 0,
        "op": "in",
        "values": [
          1
        ]
      }
    ],
    "name": "é‡‘æ²™æ±Ÿè·¯ StarRocks BE å®žä¾‹æŽ‰çº¿å‘Šè­¦",
    "note": "é‡‘æ²™æ±Ÿè·¯ StarRocks BE å®žä¾‹å­˜æ´»å¼‚å¸¸\n\n**ðŸ“Œ æ£€æµ‹æŒ‡æ ‡ä¿¡æ¯**  \nâ–¸ å®žä¾‹åœ°å€ï¼š`{{$labels.instance}}`  \nâ–¸ çŠ¶æ€ï¼š`down`  \nâ–¸ è§¦å‘æ¡ä»¶ï¼šBE å®žä¾‹ `up == 0`  \n\n**ðŸ“ å½±å“åˆ†æž**  \nâœ“ å½“å‰ BE å®žä¾‹ä¸å¯è¾¾ï¼Œå¯èƒ½å½±å“æ•°æ®å­˜å‚¨å’ŒæŸ¥è¯¢æ€§èƒ½  \nâœ“ å¤šä¸ª BE å¼‚å¸¸å¯èƒ½é€ æˆåˆ†å¸ƒå¼è®¡ç®—ä¸­æ–­æˆ–æŸ¥è¯¢å¤±è´¥\n\n**ðŸ› ï¸ å¤„ç†å»ºè®®**  \nâœ“ ç™»å½•å®žä¾‹æŸ¥çœ‹ BE æ—¥å¿—ï¼ˆå¦‚ `/apps/StarRocks/be/log/be.INFO`, `/apps/StarRocks/be/log/be.out`ï¼‰  \nâœ“ æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œã€ç«¯å£æ˜¯å¦ç›‘å¬ã€èµ„æºæ˜¯å¦è€—å°½  \nâœ“ å¯å°è¯•é‡å¯ BE æœåŠ¡æˆ–å®¹å™¨",
    "prod": "metric",
    "delay": 0,
    "prom_for_duration": 30,
    "rule_config": {
      "queries": [
        {
          "prom_ql": "up{job=\"jsj-starrocks\", endpoint=\"be-metrics\"} == 0",
          "severity": 1,
          "unit": "none"
        }
      ]
    },
    "event_relabel_config": null,
    "prom_eval_interval": 15,
    "enable_in_bg": 0,
    "notify_recovered": 1,
    "notify_repeat_step": 60,
    "notify_max_number": 0,
    "recover_duration": 0,
    "callbacks": [],
    "append_tags": [
      "project=jsj"
    ],
    "annotations": {},
    "uuid": 0,
    "cur_event_count": 0,
    "update_by_nickname": "è¶…ç®¡",
    "cron_pattern": "@every 30s",
    "notify_rule_ids": [
      1
    ],
    "notify_version": 1
  },
  {
    "cate": "prometheus",
    "datasource_queries": [
      {
        "match_type": 0,
        "op": "in",
        "values": [
          1
        ]
      }
    ],
    "name": "é‡‘æ²™æ±Ÿè·¯ StarRocks BE ç£ç›˜ä½¿ç”¨çŽ‡è¿‡é«˜",
    "note": "é‡‘æ²™æ±Ÿè·¯ StarRocks BE ç£ç›˜ä½¿ç”¨çŽ‡è¿‡é«˜\n\n**ðŸ“Œ æ£€æµ‹æŒ‡æ ‡ä¿¡æ¯**  \nâ–¸ èŠ‚ç‚¹ Hostï¼š`{{$labels.instance}}`  \nâ–¸ ç£ç›˜è·¯å¾„ï¼š`{{$labels.path}}`  \nâ–¸ å½“å‰ç£ç›˜ä½¿ç”¨çŽ‡ï¼š`{{ printf \"%.2f\" $value }}%`  \nâ–¸ è§¦å‘æ¡ä»¶ï¼šä½¿ç”¨çŽ‡å¤§äºŽ 90%\n\n**ðŸ“ å½±å“åˆ†æž**  \nâœ“ ç£ç›˜ç©ºé—´ä¸è¶³å¯èƒ½å¯¼è‡´æ•°æ®å†™å…¥å¤±è´¥  \nâœ“ æŒç»­å æ»¡ä¼šå½±å“ BE çš„æ­£å¸¸è¿è¡Œå’ŒæŸ¥è¯¢æ€§èƒ½  \nâœ“ è¶…å‡ºé˜ˆå€¼åŽ BE èŠ‚ç‚¹å¯èƒ½è¢«å¼ºåˆ¶ä¸‹çº¿æˆ–å†™å…¥ä¸­æ–­\n\n**ðŸ› ï¸ å¤„ç†å»ºè®®**  \nâœ“ æ¸…ç†æ— ç”¨æ•°æ®æˆ–æ—¥å¿—  \nâœ“ æ‰©å®¹ç£ç›˜æˆ–è°ƒæ•´æ•°æ®åˆ†å¸ƒ  \nâœ“ æ£€æŸ¥ StarRocks BE èŠ‚ç‚¹çš„å­˜å‚¨é…ç½®å’Œå†™å…¥ç­–ç•¥",
    "prod": "metric",
    "delay": 0,
    "prom_for_duration": 30,
    "rule_config": {
      "queries": [
        {
          "prom_ql": "(SUM(starrocks_be_disks_total_capacity{job=\"jsj-starrocks\"}) by (instance, path) \n - SUM(starrocks_be_disks_avail_capacity{job=\"jsj-starrocks\"}) by (instance, path)) \n/ SUM(starrocks_be_disks_total_capacity{job=\"jsj-starrocks\"}) by (instance, path) * 100 > 90",
          "severity": 2,
          "unit": "none"
        }
      ]
    },
    "event_relabel_config": null,
    "prom_eval_interval": 15,
    "enable_in_bg": 0,
    "notify_recovered": 1,
    "notify_repeat_step": 60,
    "notify_max_number": 0,
    "recover_duration": 0,
    "callbacks": [],
    "append_tags": [
      "project=jsj"
    ],
    "annotations": {},
    "uuid": 0,
    "cur_event_count": 0,
    "update_by_nickname": "è¶…ç®¡",
    "cron_pattern": "@every 30s",
    "notify_rule_ids": [
      1
    ],
    "notify_version": 1
  },
  {
    "cate": "prometheus",
    "datasource_queries": [
      {
        "match_type": 0,
        "op": "in",
        "values": [
          1
        ]
      }
    ],
    "name": "é‡‘æ²™æ±Ÿè·¯ StarRocks FE CheckPoint å¤±è´¥æŠ¥è­¦",
    "note": "é‡‘æ²™æ±Ÿè·¯ StarRocks FE CheckPoint å¤±è´¥æŠ¥è­¦\n\n**ðŸ“Œ æ£€æµ‹æŒ‡æ ‡ä¿¡æ¯**  \nâ–¸ å®žä¾‹åœ°å€ï¼š`{{$labels.instance}}`  \nâ–¸ å½“å‰ BDB æ—¥å¿—æ•°é‡ï¼š`{{$value}}`  \nâ–¸ è§¦å‘æ¡ä»¶ï¼šmeta_log_count è¶…è¿‡ 100000ï¼ŒCheckPoint æœªè§¦å‘æˆ–å¤±è´¥\n\n**ðŸ“ é—®é¢˜è¯´æ˜Ž**  \nâœ“ æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ—¥å¿—æ•°é‡è¶…è¿‡ 50000 æ—¶ç³»ç»Ÿåº”è‡ªåŠ¨è§¦å‘ CheckPoint  \nâœ“ è‹¥æ—¥å¿—å †ç§¯è¶…è¿‡ 100000 ä¸”æœªé‡ç½®ï¼Œå¯èƒ½è¡¨ç¤º CheckPoint å‡ºçŽ°æ•…éšœ  \nâœ“ é•¿æœŸæœª CheckPoint ä¼šå¯¼è‡´å…ƒæ•°æ®è†¨èƒ€ï¼Œå½±å“ç³»ç»Ÿå¯åŠ¨å’Œæ€§èƒ½\n\n**ðŸ›  å¤„ç†å»ºè®®**  \n- ç™»å½• FE Leader èŠ‚ç‚¹ï¼ŒæŸ¥çœ‹ `fe.log` æ—¥å¿—æ–‡ä»¶  \n- æœç´¢å…³é”®å­— `begin to generate new image:` å’Œ `checkpoint finished save image`  \n- è‹¥å­˜åœ¨ `Exception when generate new image file`ï¼Œè¯´æ˜Ž CheckPoint å¤±è´¥  \n- åˆ†æžå¤±è´¥åŽŸå› å‰ï¼Œè¯·å‹¿ç›´æŽ¥æ“ä½œå…ƒæ•°æ®ï¼Œå»ºè®®è”ç³»æ”¯æŒäººå‘˜ååŠ©å¤„ç†\n\nè¯·åŠæ—¶æŽ’æŸ¥ FE èŠ‚ç‚¹çŠ¶æ€ï¼Œç¡®ä¿å…ƒæ•°æ®å®‰å…¨ä¸Žç³»ç»Ÿç¨³å®šæ€§ã€‚",
    "prod": "metric",
    "delay": 0,
    "prom_for_duration": 30,
    "rule_config": {
      "queries": [
        {
          "prom_ql": "starrocks_fe_meta_log_count{job=\"jsj-starrocks\",instance=\"10.84.91.16:8030\"} > 100000",
          "severity": 2,
          "unit": "none"
        }
      ]
    },
    "event_relabel_config": null,
    "prom_eval_interval": 15,
    "enable_in_bg": 0,
    "notify_recovered": 1,
    "notify_repeat_step": 60,
    "notify_max_number": 0,
    "recover_duration": 0,
    "callbacks": [],
    "append_tags": [
      "project=jsj"
    ],
    "annotations": {},
    "uuid": 0,
    "cur_event_count": 0,
    "update_by_nickname": "è¶…ç®¡",
    "cron_pattern": "@every 30s",
    "notify_rule_ids": [
      1
    ],
    "notify_version": 1
  },
  {
    "cate": "prometheus",
    "datasource_queries": [
      {
        "match_type": 0,
        "op": "in",
        "values": [
          1
        ]
      }
    ],
    "name": "é‡‘æ²™æ±Ÿè·¯ StarRocks FE Compaction åŽ‹åŠ›è¿‡å¤§",
    "note": "é‡‘æ²™æ±Ÿè·¯ StarRocks FE Compaction åŽ‹åŠ›è¿‡å¤§\n\nå‘Šè­¦æè¿°:\n**ðŸ“Œ æ£€æµ‹æŒ‡æ ‡ä¿¡æ¯**  \nâ–¸ å®žä¾‹åœ°å€ï¼š`{{$labels.instance}}`  \nâ–¸ å½“å‰æœ€å¤§ Compaction Scoreï¼š`{{$value}}`  \nâ–¸ è§¦å‘æ¡ä»¶ï¼šCompaction Score å¤§äºŽ 100ï¼ˆåŽ‹åŠ›è¿‡å¤§ï¼‰\n\n**ðŸ“ é—®é¢˜è¯´æ˜Ž**  \nâœ“ FE èŠ‚ç‚¹ Compaction åŽ‹åŠ›è¿‡å¤§ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå†™å…¥/æŸ¥è¯¢æ€§èƒ½ä¸‹é™  \nâœ“ é€šå¸¸æ˜¯ç”±äºŽé«˜é¢‘çŽ‡å¯¼å…¥ã€`INSERT INTO VALUES` æˆ–å¹¶å‘ `DELETE` æ“ä½œé€ æˆ  \n\n**ðŸ›  å¤„ç†å»ºè®®**  \n- æ£€æŸ¥è¿‘æœŸæ˜¯å¦æœ‰é¢‘ç¹çš„å¯¼å…¥ä»»åŠ¡æˆ–å¤§é‡å¹¶å‘ DELETE æ“ä½œ  \n- å°½é‡é¿å…é«˜å¹¶å‘ã€å°æ‰¹é‡å¯¼å…¥ï¼Œå»ºè®®å¯¼å…¥é—´éš”ä¸å°äºŽ **5 ç§’**  \n- ä¸å»ºè®®åŒæ—¶æäº¤å¤§é‡ `DELETE` ä»»åŠ¡  \n\nå¯é€šè¿‡ç³»ç»Ÿæ—¥å¿—å’Œå¯¼å…¥ä»»åŠ¡åˆ†æžï¼Œè¿›ä¸€æ­¥åˆ¤æ–­è´Ÿè½½æ¥æºã€‚",
    "prod": "metric",
    "delay": 0,
    "prom_for_duration": 30,
    "rule_config": {
      "queries": [
        {
          "prom_ql": "starrocks_fe_max_tablet_compaction_score{job=\"jsj-starrocks\",instance=\"10.84.91.16:8030\"} > 100",
          "severity": 2,
          "unit": "none"
        }
      ]
    },
    "event_relabel_config": null,
    "prom_eval_interval": 15,
    "enable_in_bg": 0,
    "notify_recovered": 1,
    "notify_repeat_step": 60,
    "notify_max_number": 0,
    "recover_duration": 0,
    "callbacks": [],
    "append_tags": [
      "project=jsj"
    ],
    "annotations": {},
    "uuid": 0,
    "cur_event_count": 0,
    "update_by_nickname": "è¶…ç®¡",
    "cron_pattern": "@every 30s",
    "notify_rule_ids": [
      1
    ],
    "notify_version": 1
  },
  {
    "cate": "prometheus",
    "datasource_queries": [
      {
        "match_type": 0,
        "op": "in",
        "values": [
          1
        ]
      }
    ],
    "name": "é‡‘æ²™æ±Ÿè·¯ StarRocks FE JVM ä½¿ç”¨çŽ‡é«˜æŠ¥è­¦",
    "note": "é‡‘æ²™æ±Ÿè·¯ StarRocks FE JVM ä½¿ç”¨çŽ‡è¶…è¿‡ 90%\n\n**ðŸ“Œ æ£€æµ‹æŒ‡æ ‡ä¿¡æ¯**  \nâ–¸ å®žä¾‹åœ°å€ï¼š`{{$labels.instance}}`  \nâ–¸ å½“å‰ä½¿ç”¨çŽ‡ï¼š`{{$value}}%`  \nâ–¸ è§¦å‘æ¡ä»¶ï¼šFE JVM å †ä½¿ç”¨çŽ‡è¶…è¿‡ 90%\n\n**ðŸ“ é—®é¢˜è¯´æ˜Ž**  \nâœ“ FE èŠ‚ç‚¹ JVM å†…å­˜ä½¿ç”¨è¿‡é«˜ï¼Œå¯èƒ½å‡ºçŽ°é¢‘ç¹ GC æˆ– OOM  \nâœ“ ç³»ç»Ÿå¯èƒ½å¤„äºŽé«˜è´Ÿè½½çŠ¶æ€ï¼Œæˆ–å­˜åœ¨å†…å­˜æ³„æ¼é£Žé™©\n\n**ðŸ›  å¤„ç†å»ºè®®**  \n- ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯¼å‡ºå†…å­˜ä½¿ç”¨å¿«ç…§ï¼ˆå»ºè®®ç”¨äºŽæŽ’æŸ¥ï¼‰ï¼š  \n  > æ³¨æ„ï¼šåŠ  `:live` å¯èƒ½ä¼šå¯¼è‡´ FE é‡å¯ï¼Œè¯·è°¨æ…Žæ“ä½œ  \n  ```bash\n  jmap -histo[:live] $fe_pid > jmap.dump\n",
    "prod": "metric",
    "delay": 0,
    "prom_for_duration": 30,
    "rule_config": {
      "queries": [
        {
          "prom_ql": "sum by (instance) (jvm_heap_size_bytes{job=\"jsj-starrocks\", type=\"used\"}) * 100 / sum by (instance) (jvm_heap_size_bytes{job=\"jsj-starrocks\", type=\"max\"}) > 90",
          "severity": 2,
          "unit": "none"
        }
      ]
    },
    "event_relabel_config": null,
    "prom_eval_interval": 15,
    "enable_in_bg": 0,
    "notify_recovered": 1,
    "notify_repeat_step": 60,
    "notify_max_number": 0,
    "recover_duration": 0,
    "callbacks": [],
    "append_tags": [
      "project=jsj"
    ],
    "annotations": {},
    "uuid": 0,
    "cur_event_count": 0,
    "update_by_nickname": "è¶…ç®¡",
    "cron_pattern": "@every 30s",
    "notify_rule_ids": [
      1
    ],
    "notify_version": 1
  },
  {
    "cate": "prometheus",
    "datasource_queries": [
      {
        "match_type": 0,
        "op": "in",
        "values": [
          1
        ]
      }
    ],
    "name": "é‡‘æ²™æ±Ÿè·¯ StarRocks FE å®žä¾‹æŽ‰çº¿å‘Šè­¦",
    "note": "é‡‘æ²™æ±Ÿè·¯ StarRocks FE å®žä¾‹å­˜æ´»å¼‚å¸¸\n\n**ðŸ“Œ æ£€æµ‹æŒ‡æ ‡ä¿¡æ¯**  \nâ–¸ å®žä¾‹åœ°å€ï¼š`{{$labels.instance}}`  \nâ–¸ çŠ¶æ€ï¼š`down`  \nâ–¸ è§¦å‘æ¡ä»¶ï¼šFE å®žä¾‹ `up == 0`  \n\n**ðŸ“ å½±å“åˆ†æž**  \nâœ“ å½“å‰ FE å®žä¾‹ä¸å¯è¾¾ï¼Œå¯èƒ½æ— æ³•å‚ä¸Žå…ƒæ•°æ®åŒæ­¥å’ŒæŸ¥è¯¢è°ƒåº¦  \nâœ“ å¤šä¸ªå®žä¾‹åŒæ—¶å¼‚å¸¸å¯èƒ½å½±å“æ•´ä¸ªé›†ç¾¤ç¨³å®šæ€§  \n\n**ðŸ› ï¸ å¤„ç†å»ºè®®**  \nâœ“ ç™»å½•å®žä¾‹æŸ¥çœ‹ FE æ—¥å¿—ï¼Œè·¯å¾„å¦‚ `/apps/StarRocks/fe/log/fe.log`  \nâœ“ æ£€æŸ¥å®¹å™¨ã€æœåŠ¡ç«¯å£å’Œç½‘ç»œè¿žé€šæ€§  \nâœ“ è‹¥ä¸ºæ»šåŠ¨é‡å¯æˆ–é¢„æœŸå®•æœºï¼Œè¯·å¿½ç•¥å‘Šè­¦æˆ–è®¾ç½®ç»´æŠ¤çª—å£",
    "prod": "metric",
    "delay": 0,
    "prom_for_duration": 30,
    "rule_config": {
      "queries": [
        {
          "prom_ql": "up{job=\"jsj-starrocks\", endpoint=\"fe-metrics\"} == 0",
          "severity": 1,
          "unit": "none"
        }
      ]
    },
    "event_relabel_config": null,
    "prom_eval_interval": 15,
    "enable_in_bg": 0,
    "notify_recovered": 1,
    "notify_repeat_step": 60,
    "notify_max_number": 0,
    "recover_duration": 0,
    "callbacks": [],
    "append_tags": [
      "project=jsj"
    ],
    "annotations": {},
    "uuid": 0,
    "cur_event_count": 0,
    "update_by_nickname": "è¶…ç®¡",
    "cron_pattern": "@every 30s",
    "notify_rule_ids": [
      1
    ],
    "notify_version": 1
  },
  {
    "cate": "prometheus",
    "datasource_queries": [
      {
        "match_type": 0,
        "op": "in",
        "values": [
          1
        ]
      }
    ],
    "name": "é‡‘æ²™æ±Ÿè·¯ StarRocks FE çº¿ç¨‹æ•°é«˜æŠ¥è­¦",
    "note": "é‡‘æ²™æ±Ÿè·¯ StarRocks FE çº¿ç¨‹æ•°å¤§äºŽ3000\n\n**ðŸ“Œ æ£€æµ‹æŒ‡æ ‡ä¿¡æ¯**  \nâ–¸ å®žä¾‹åœ°å€ï¼š`{{$labels.instance}}`  \nâ–¸ çº¿ç¨‹æ± ç±»åž‹ï¼š`{{$labels.type}}`  \nâ–¸ å½“å‰çº¿ç¨‹æ•°ï¼š`{{$value}}`  \nâ–¸ è§¦å‘æ¡ä»¶ï¼šFE æŸç±»çº¿ç¨‹æ± çº¿ç¨‹æ•°è¶…è¿‡ 3000\n\n**ðŸ“ é—®é¢˜è¯´æ˜Ž**  \nâœ“ StarRocks FE èŠ‚ç‚¹çº¿ç¨‹æ•°é»˜è®¤ä¸Šé™ä¸º 4096  \nâœ“ è‹¥çº¿ç¨‹æ•°æŒç»­è¿‡é«˜ï¼Œå¯èƒ½å¯¼è‡´è¯·æ±‚ç§¯åŽ‹ã€æœåŠ¡å“åº”å˜æ…¢ç”šè‡³æ‹’ç»è¿žæŽ¥  \nâœ“ å¸¸è§è¯±å› æ˜¯é¢‘ç¹ä¸”é«˜å¹¶å‘çš„ `UNION ALL` æŸ¥è¯¢æˆ–é”™è¯¯çš„å¹¶å‘é…ç½®\n\n**ðŸ›  å¤„ç†å»ºè®®**  \n- ä¼˜åŒ– SQLï¼šé™ä½Ž `UNION ALL` æŸ¥è¯¢çš„å¹¶å‘ï¼Œæ‹†åˆ†æˆ–åˆå¹¶è¯­å¥  \n- è®¾ç½®æŸ¥è¯¢å¹¶å‘åº¦é™åˆ¶ï¼šå»ºè®®é€‚å½“è°ƒä½Ž `pipeline_dop`ï¼Œå¦‚ï¼š  \nSET GLOBAL pipeline_dop=8;\n- ç´§æ€¥æƒ…å†µä¸‹ï¼Œä¸ºå°½å¿«æ¢å¤æœåŠ¡ï¼Œå¯ä»¥é€‰æ‹©è°ƒå¤§ FE åŠ¨æ€å‚æ•° thrift_server_max_worker_threadsï¼ˆé»˜è®¤å€¼ï¼š4096ï¼‰\nADMIN SET FRONTEND CONFIG (\"thrift_server_max_worker_threads\"=\"8192\");",
    "prod": "metric",
    "delay": 0,
    "prom_for_duration": 1,
    "rule_config": {
      "queries": [
        {
          "prom_ql": "starrocks_fe_thread_pool{job=\"jsj-starrocks\", type!=\"completed_task_count\"} > 3000",
          "severity": 2,
          "unit": "none"
        }
      ]
    },
    "event_relabel_config": null,
    "prom_eval_interval": 15,
    "enable_in_bg": 0,
    "notify_recovered": 1,
    "notify_repeat_step": 60,
    "notify_max_number": 0,
    "recover_duration": 0,
    "callbacks": [],
    "append_tags": [
      "project=jsj"
    ],
    "annotations": {},
    "uuid": 0,
    "cur_event_count": 0,
    "update_by_nickname": "è¶…ç®¡",
    "cron_pattern": "@every 15s",
    "notify_rule_ids": [
      1
    ],
    "notify_version": 1
  },
  {
    "cate": "prometheus",
    "datasource_queries": [
      {
        "match_type": 0,
        "op": "in",
        "values": [
          1
        ]
      }
    ],
    "name": "é‡‘æ²™æ±Ÿè·¯ StarRocks Routine Load æ¶ˆè´¹å»¶è¿Ÿè¿‡é«˜",
    "note": "é‡‘æ²™æ±Ÿè·¯ StarRocks Routine Load æ¶ˆè´¹å»¶è¿Ÿè¶…è¿‡ 30 ä¸‡æ¡\n\n**ðŸ“Œ æ£€æµ‹æŒ‡æ ‡ä¿¡æ¯**  \nâ–¸ å®žä¾‹åœ°å€ï¼š`{{$labels.instance}}`    \nâ–¸ å½“å‰æœ€å¤§å»¶è¿Ÿï¼š`{{$value}}` æ¡  \nâ–¸ è§¦å‘æ¡ä»¶ï¼šæœ€å¤§æ¶ˆè´¹å»¶è¿Ÿè¶…è¿‡ 30 ä¸‡æ¡\n\n**ðŸ“ é—®é¢˜è¯´æ˜Ž**  \nâœ“ Routine Load ä»»åŠ¡æ¶ˆè´¹å †ç§¯ï¼ŒKafka/æ•°æ®æºæ•°æ®æœªè¢«åŠæ—¶å¤„ç†  \nâœ“ å¯èƒ½å› ä»»åŠ¡è°ƒåº¦å¼‚å¸¸ã€èµ„æºç“¶é¢ˆæˆ–æ¶ˆè´¹èƒ½åŠ›ä¸è¶³å¯¼è‡´\n\n**ðŸ›  å¤„ç†å»ºè®®**  \n- ç™»å½• FE èŠ‚ç‚¹ï¼ŒæŸ¥çœ‹ä»»åŠ¡çŠ¶æ€  \n- æ£€æŸ¥ä»»åŠ¡çŠ¶æ€æ˜¯å¦ä¸º `NEED_SCHEDULE`ã€`PAUSED` æˆ– `UNSTABLE`  \n- æŸ¥çœ‹ FE æ—¥å¿—ä¸­æ˜¯å¦å­˜åœ¨è°ƒåº¦å¤±è´¥ã€æ¶ˆè´¹å¤±è´¥ã€ä»»åŠ¡å´©æºƒç­‰ä¿¡æ¯  \n- æ£€æŸ¥ç³»ç»Ÿèµ„æºæ˜¯å¦è¶³å¤Ÿï¼ˆCPU/Mem/IOï¼‰  \n- å¯ä½¿ç”¨ SQL æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€ï¼š  \n  SHOW ROUTINE LOAD;",
    "prod": "metric",
    "delay": 0,
    "prom_for_duration": 30,
    "rule_config": {
      "queries": [
        {
          "prom_ql": "rate(starrocks_fe_txn_failed{job=\"jsj-starrocks\",instance=\"10.84.91.16:8030\"}[5m]) * 100 > 5",
          "severity": 2,
          "unit": "none"
        }
      ]
    },
    "event_relabel_config": null,
    "prom_eval_interval": 15,
    "enable_in_bg": 0,
    "notify_recovered": 1,
    "notify_repeat_step": 60,
    "notify_max_number": 0,
    "recover_duration": 0,
    "callbacks": [],
    "append_tags": [
      "project=jsj"
    ],
    "annotations": {},
    "uuid": 0,
    "cur_event_count": 0,
    "update_by_nickname": "è¶…ç®¡",
    "cron_pattern": "@every 30s",
    "notify_rule_ids": [
      1
    ],
    "notify_version": 1
  },
  {
    "cate": "prometheus",
    "datasource_queries": [
      {
        "match_type": 0,
        "op": "in",
        "values": [
          1
        ]
      }
    ],
    "name": "é‡‘æ²™æ±Ÿè·¯ StarRocks Schema Change å¼‚å¸¸æŠ¥è­¦",
    "note": "é‡‘æ²™æ±Ÿè·¯ StarRocks Schema Change å¼‚å¸¸æŠ¥è­¦\n\n**ðŸ“Œ æ£€æµ‹æŒ‡æ ‡ä¿¡æ¯**  \nâ–¸ å®žä¾‹ï¼š`{{$labels.instance}}`  \nâ–¸ å½“å‰å¤±è´¥æ¬¡æ•°ï¼ˆè¿‘ 1 åˆ†é’Ÿï¼‰ï¼š`{{$value}}`  \nâ–¸ ç±»åž‹ï¼š`Schema Change`  \nâ–¸ è§¦å‘æ¡ä»¶ï¼š1 åˆ†é’Ÿå†…å¤±è´¥æ¬¡æ•° > 1\n\n**ðŸ“ é—®é¢˜è¯´æ˜Ž**  \nâœ“ Schema Change æ“ä½œå¤±è´¥å¯èƒ½å½±å“ DDL æ‰§è¡Œå’Œè¡¨ç»“æž„æ›´æ–°  \nâœ“ å¤±è´¥å¯èƒ½ç”±å­—æ®µå†²çªã€å…ƒæ•°æ®å¼‚å¸¸æˆ–ä»»åŠ¡è°ƒåº¦å¤±è´¥å¼•èµ·  \n\n**ðŸ›  å¤„ç†å»ºè®®**  \n- æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æŽ’æŸ¥å¤±è´¥ä»»åŠ¡ä¿¡æ¯ï¼š\nSHOW ALTER COLUMN FROM $db;",
    "prod": "metric",
    "delay": 0,
    "prom_for_duration": 1,
    "rule_config": {
      "queries": [
        {
          "prom_ql": "increase(starrocks_be_engine_requests_total{job=\"jsj-starrocks\", type=\"schema_change\", status=\"failed\"}[1m]) > 1",
          "severity": 2,
          "unit": "none"
        }
      ]
    },
    "event_relabel_config": null,
    "prom_eval_interval": 15,
    "enable_in_bg": 0,
    "notify_recovered": 1,
    "notify_repeat_step": 60,
    "notify_max_number": 0,
    "recover_duration": 0,
    "callbacks": [],
    "append_tags": [
      "project=jsj"
    ],
    "annotations": {},
    "uuid": 0,
    "cur_event_count": 0,
    "update_by_nickname": "è¶…ç®¡",
    "cron_pattern": "@every 15s",
    "notify_rule_ids": [
      1
    ],
    "notify_version": 1
  },
  {
    "cate": "prometheus",
    "datasource_queries": [
      {
        "match_type": 0,
        "op": "in",
        "values": [
          1
        ]
      }
    ],
    "name": "é‡‘æ²™æ±Ÿè·¯ StarRocks å•ä¸ª DB å¯¼å…¥äº‹åŠ¡è¶…é™",
    "note": "é‡‘æ²™æ±Ÿè·¯ StarRocks å•ä¸ª DB å¯¼å…¥äº‹åŠ¡è¶…é™\n\n**ðŸ“Œ æ£€æµ‹æŒ‡æ ‡ä¿¡æ¯**  \nâ–¸ æ•°æ®åº“åç§°ï¼š`{{$labels.db}}`  \nâ–¸ å½“å‰å¯¼å…¥äº‹åŠ¡æ•°ï¼š`{{$value}}`  \nâ–¸ è§¦å‘æ¡ä»¶ï¼šæŸä¸ªæ•°æ®åº“å¯¼å…¥äº‹åŠ¡æ•° > 900ï¼ˆv3.1 å‰ä¸º 100ï¼‰\n\n**ðŸ“ é—®é¢˜è¯´æ˜Ž**  \nâœ“ å•ä¸ª DB å¯¼å…¥äº‹åŠ¡æ•°é‡å¼‚å¸¸å¢žé•¿  \nâœ“ å¯èƒ½å› å¯¼å…¥ä»»åŠ¡é¢‘ç¹ã€ç§¯åŽ‹ä¸¥é‡å¯¼è‡´ç³»ç»ŸåŽ‹åŠ›å¢žå¤§\n\n**ðŸ›  å¤„ç†å»ºè®®**  \n- æ£€æŸ¥è¯¥ DB æ˜¯å¦å­˜åœ¨å¤§é‡å¯¼å…¥ä»»åŠ¡åŒæ—¶è¿›è¡Œ  \n- è€ƒè™‘ä¼˜åŒ–å¯¼å…¥é¢‘çŽ‡æˆ–åˆ†æ‰¹å¯¼å…¥  \n- å¯ä¸´æ—¶æå‡äº‹åŠ¡æ•°é™åˆ¶ï¼ˆæ ¹æ®ç‰ˆæœ¬ï¼‰ï¼š\nADMIN SET FRONTEND CONFIG (\"max_running_txn_num_per_db\" = \"2000\");",
    "prod": "metric",
    "delay": 0,
    "prom_for_duration": 30,
    "rule_config": {
      "queries": [
        {
          "prom_ql": "sum(starrocks_fe_txn_running{job=\"jsj-starrocks\"}) by (db) > 900",
          "severity": 2,
          "unit": "none"
        }
      ]
    },
    "event_relabel_config": null,
    "prom_eval_interval": 15,
    "enable_in_bg": 0,
    "notify_recovered": 1,
    "notify_repeat_step": 60,
    "notify_max_number": 0,
    "recover_duration": 0,
    "callbacks": [],
    "append_tags": [
      "project=jsj"
    ],
    "annotations": {},
    "uuid": 0,
    "cur_event_count": 0,
    "update_by_nickname": "è¶…ç®¡",
    "cron_pattern": "@every 30s",
    "notify_rule_ids": [
      1
    ],
    "notify_version": 1
  },
  {
    "cate": "prometheus",
    "datasource_queries": [
      {
        "match_type": 0,
        "op": "in",
        "values": [
          1
        ]
      }
    ],
    "name": "é‡‘æ²™æ±Ÿè·¯ StarRocks å¯¼å…¥å¤±è´¥çŽ‡è¿‡é«˜æŠ¥è­¦",
    "note": "é‡‘æ²™æ±Ÿè·¯ StarRocks å¯¼å…¥å¤±è´¥çŽ‡è¶…è¿‡ 5%\n\n**ðŸ“Œ æ£€æµ‹æŒ‡æ ‡ä¿¡æ¯**  \nâ–¸ å®žä¾‹åœ°å€ï¼š`{{$labels.instance}}`  \nâ–¸ å½“å‰å¤±è´¥çŽ‡ï¼š`{{$value}}%`  \nâ–¸ è§¦å‘æ¡ä»¶ï¼šå¯¼å…¥å¤±è´¥äº‹åŠ¡å æ¯”è¶…è¿‡ 5%\n\n**ðŸ“ é—®é¢˜è¯´æ˜Ž**  \nâœ“ FE èŠ‚ç‚¹å¯¼å…¥äº‹åŠ¡å¤±è´¥çŽ‡å¼‚å¸¸å‡é«˜  \nâœ“ å¯èƒ½ç”±ç½‘ç»œæŠ–åŠ¨ã€å†™å…¥åŽ‹åŠ›è¿‡å¤§æˆ–ä»»åŠ¡å¼‚å¸¸ç­‰å¯¼è‡´\n\n**ðŸ›  å¤„ç†å»ºè®®**  \n- ç™»å½• Leader FE èŠ‚ç‚¹ï¼Œæ£€æŸ¥ `fe.log` æ—¥å¿—  \n- å¯æœç´¢å…³é”®å­—ï¼š`status: ABORTED`  \n- æŸ¥çœ‹å¤±è´¥çš„å¯¼å…¥äº‹åŠ¡è®°å½•ï¼Œå¦‚ï¼š  \n  ```text\n  transaction status: ABORTED, reason: [E1008]Reached timeout=30000ms",
    "prod": "metric",
    "delay": 0,
    "prom_for_duration": 1,
    "rule_config": {
      "queries": [
        {
          "prom_ql": "rate(starrocks_fe_txn_failed{job=\"jsj-starrocks\",instance=\"10.84.91.16:8030\"}[5m]) * 100 > 5",
          "severity": 2,
          "unit": "none"
        }
      ]
    },
    "event_relabel_config": null,
    "prom_eval_interval": 15,
    "enable_in_bg": 0,
    "notify_recovered": 1,
    "notify_repeat_step": 60,
    "notify_max_number": 0,
    "recover_duration": 0,
    "callbacks": [],
    "append_tags": [
      "project=jsj"
    ],
    "annotations": {},
    "uuid": 0,
    "cur_event_count": 0,
    "update_by_nickname": "è¶…ç®¡",
    "cron_pattern": "@every 15s",
    "notify_rule_ids": [
      1
    ],
    "notify_version": 1
  },
  {
    "cate": "prometheus",
    "datasource_queries": [
      {
        "match_type": 0,
        "op": "in",
        "values": [
          1
        ]
      }
    ],
    "name": "é‡‘æ²™æ±Ÿè·¯ StarRocks æŸ¥è¯¢å¤±è´¥çŽ‡å¼‚å¸¸",
    "note": "é‡‘æ²™æ±Ÿè·¯ StarRocks å¤±è´¥æŸ¥è¯¢æ•°è¶…è¿‡ 10 æ¬¡\n\n**ðŸ“Œ æ£€æµ‹æŒ‡æ ‡ä¿¡æ¯**  \nâ–¸ å®žä¾‹ï¼š`{{$labels.instance}}`  \nâ–¸ å½“å‰å¤±è´¥çŽ‡/æ•°é‡ï¼š`{{$value}}`  \nâ–¸ è§¦å‘æ¡ä»¶ï¼š  \n  - æŸ¥è¯¢å¤±è´¥çŽ‡è¶…è¿‡ 10%  \n  - æˆ– 1 åˆ†é’Ÿå†…å¤±è´¥æŸ¥è¯¢æ•°è¶…è¿‡ 10 æ¬¡ï¼ˆå†…éƒ¨é”™è¯¯ï¼‰\n\n**ðŸ“ é—®é¢˜è¯´æ˜Ž**  \nâœ“ æŸ¥è¯¢å¤±è´¥çŽ‡æ˜¾è‘—å‡é«˜ï¼Œå¯èƒ½å½±å“æ­£å¸¸ä¸šåŠ¡è¯·æ±‚  \nâœ“ æŸ¥è¯¢å¤±è´¥å¯èƒ½ç”±è¯­æ³•é”™è¯¯ã€è¶…æ—¶ã€èµ„æºå¼‚å¸¸æˆ–ç³»ç»Ÿæ•…éšœå¼•èµ·\n\n**ðŸ›  å¤„ç†å»ºè®®**  \n- ä½¿ç”¨ `grep 'State=ERR' fe.audit.log` æŸ¥çœ‹å…·ä½“å¤±è´¥æŸ¥è¯¢  \n- è‹¥å®‰è£…äº† AuditLoader æ’ä»¶ï¼Œå¯é€šè¿‡ SQL æŸ¥è¯¢å¤±è´¥è¯­å¥ï¼š  \n  `SELECT stmt FROM starrocks_audit_db__.starrocks_audit_tbl__ WHERE state='ERR';`  \n- æ£€æŸ¥ fe.log æ˜¯å¦å­˜åœ¨å†…éƒ¨é”™è¯¯ã€å¼‚å¸¸å †æ ˆã€Query Dump ç­‰ä¿¡æ¯  \n- å¯è”ç³»æ”¯æŒäººå‘˜åˆ†æžå†…æ ¸å¼‚å¸¸æƒ…å†µ\n\nè¯·å°½å¿«æŽ’æŸ¥ï¼Œé¿å…å½±å“æ›´å¤šç”¨æˆ·è¯·æ±‚ã€‚",
    "prod": "metric",
    "delay": 0,
    "prom_for_duration": 30,
    "rule_config": {
      "queries": [
        {
          "prom_ql": "increase(starrocks_fe_query_internal_err{job=\"jsj-starrocks\"}[1m]) > 10",
          "severity": 2,
          "unit": "none"
        }
      ]
    },
    "event_relabel_config": null,
    "prom_eval_interval": 15,
    "enable_in_bg": 0,
    "notify_recovered": 1,
    "notify_repeat_step": 60,
    "notify_max_number": 0,
    "recover_duration": 0,
    "callbacks": [],
    "append_tags": [
      "project=jsj"
    ],
    "annotations": {},
    "uuid": 0,
    "cur_event_count": 0,
    "update_by_nickname": "è¶…ç®¡",
    "cron_pattern": "@every 30s",
    "notify_rule_ids": [
      1
    ],
    "notify_version": 1
  },
  {
    "cate": "prometheus",
    "datasource_queries": [
      {
        "match_type": 0,
        "op": "in",
        "values": [
          1
        ]
      }
    ],
    "name": "é‡‘æ²™æ±Ÿè·¯ StarRocks æŸ¥è¯¢å»¶è¿Ÿå¼‚å¸¸",
    "note": "é‡‘æ²™æ±Ÿè·¯ StarRocks æŸ¥è¯¢å»¶è¿Ÿå¤§äºŽ 5000msï¼ˆ5 ç§’ï¼‰\n\n**ðŸ“Œ æ£€æµ‹æŒ‡æ ‡ä¿¡æ¯**  \nâ–¸ å®žä¾‹ï¼š`{{$labels.instance}}`  \nâ–¸ Quantileï¼š`{{$labels.quantile}}`  \nâ–¸ å½“å‰ P95 æŸ¥è¯¢å»¶è¿Ÿï¼š`{{$value}} ms`  \nâ–¸ è§¦å‘æ¡ä»¶ï¼šP95 æŸ¥è¯¢å»¶è¿Ÿå¤§äºŽ 5000msï¼ˆ5 ç§’ï¼‰\n\n**ðŸ“ é—®é¢˜è¯´æ˜Ž**  \nâœ“ æŸ¥è¯¢å»¶è¿Ÿæ˜¾è‘—å‡é«˜ï¼Œå½±å“ç”¨æˆ·è¯·æ±‚ä½“éªŒ  \nâœ“ å¯èƒ½åŽŸå› åŒ…æ‹¬ï¼šæ…¢æŸ¥è¯¢ã€èµ„æºç«žäº‰ã€ç³»ç»Ÿè´Ÿè½½é«˜ç­‰\n\n**ðŸ›  å¤„ç†å»ºè®®**  \n- ä½¿ç”¨ `SHOW PROC '/current_queries'` åˆ†æžå½“å‰æ…¢æŸ¥è¯¢  \n- æ£€æŸ¥ CPUã€ç£ç›˜ IO æ˜¯å¦å­˜åœ¨ç“¶é¢ˆ  \n- æŽ’æŸ¥æ˜¯å¦å­˜åœ¨å¤§æ‰¹é‡ JOIN / GROUP BY / INSERT ä»»åŠ¡  \n- å¯é€šè¿‡é™åˆ¶å¹¶å‘æˆ–ä¼˜åŒ– SQL æå‡å“åº”é€Ÿåº¦\n- ç´§æ€¥æƒ…å†µä¸‹ï¼Œä¸ºå°½å¿«æ¢å¤æœåŠ¡ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å¤„ç†ï¼š\n\nå¦‚æžœæ˜¯å¼‚å¸¸å³°å€¼æµé‡æ¿€å¢žå¯¼è‡´èµ„æºå ç”¨é«˜å¼•èµ·çš„æŸ¥è¯¢å¤±è´¥ï¼Œå¯é€šè¿‡ç´§æ€¥å‡å°‘ä¸šåŠ¡æµé‡ï¼Œå¹¶é‡å¯å¯¹åº”çš„ BE èŠ‚ç‚¹é‡Šæ”¾ç§¯åŽ‹çš„æŸ¥è¯¢ã€‚\nå¦‚æžœæ˜¯æ­£å¸¸æƒ…å†µä¸‹èµ„æºå ç”¨é«˜è§¦å‘æŠ¥è­¦ï¼Œåˆ™å¯ä»¥è€ƒè™‘æ‰©å®¹èŠ‚ç‚¹ã€‚\n",
    "prod": "metric",
    "delay": 0,
    "prom_for_duration": 30,
    "rule_config": {
      "queries": [
        {
          "prom_ql": "starrocks_fe_query_latency_ms{job=\"jsj-starrocks\", quantile=\"0.95\"} > 5000",
          "severity": 2,
          "unit": "none"
        }
      ]
    },
    "event_relabel_config": null,
    "prom_eval_interval": 15,
    "enable_in_bg": 0,
    "notify_recovered": 1,
    "notify_repeat_step": 60,
    "notify_max_number": 0,
    "recover_duration": 0,
    "callbacks": [],
    "append_tags": [
      "project=jsj"
    ],
    "annotations": {},
    "uuid": 0,
    "cur_event_count": 0,
    "update_by_nickname": "è¶…ç®¡",
    "cron_pattern": "@every 30s",
    "notify_rule_ids": [
      1
    ],
    "notify_version": 1
  },
  {
    "cate": "prometheus",
    "datasource_queries": [
      {
        "match_type": 0,
        "op": "in",
        "values": [
          1
        ]
      }
    ],
    "name": "é‡‘æ²™æ±Ÿè·¯ StarRocks æŸ¥è¯¢è¯·æ±‚æˆ–è¿žæŽ¥æ•°çªå¢ž",
    "note": "é‡‘æ²™æ±Ÿè·¯ StarRocks æŸ¥è¯¢è¿‡è½½æŠ¥è­¦\n\n**ðŸ“Œ æ£€æµ‹æŒ‡æ ‡ä¿¡æ¯**  \nâ–¸ å®žä¾‹ï¼š`{{$labels.instance}}`  \nâ–¸ å½“å‰å˜åŒ–çŽ‡ï¼š`{{$value}}%`  \nâ–¸ è§¦å‘æ¡ä»¶ï¼šQPS æˆ–è¿žæŽ¥æ•°åœ¨è¿‘ 1 åˆ†é’Ÿå†…çŽ¯æ¯”å¢žé•¿è¶…è¿‡ 100%\n\n**ðŸ“ é—®é¢˜è¯´æ˜Ž**  \nâœ“ æŸ¥è¯¢é‡æˆ–è¿žæŽ¥æ•°æ¿€å¢žï¼Œå¯èƒ½å­˜åœ¨æŸ¥è¯¢è¿‡è½½æˆ–æ¶æ€§è¯·æ±‚  \nâœ“ é«˜é¢‘æŸ¥è¯¢è¡Œä¸ºå¯èƒ½å¯¹ FE/BE èŠ‚ç‚¹é€ æˆèµ„æºåŽ‹åŠ›\n\n**ðŸ›  å¤„ç†å»ºè®®**  \n- æ£€æŸ¥ `fe.audit.log`ï¼Œå®šä½å¼‚å¸¸æŸ¥è¯¢è¯­å¥  \n- è‹¥ä¸šåŠ¡ä¸Šæœ‰å˜æ›´ï¼Œå…³æ³¨é›†ç¾¤èµ„æºæƒ…å†µ  \n- å¯è€ƒè™‘å¢žåŠ  BE èŠ‚ç‚¹æˆ–è°ƒä½ŽæŸ¥è¯¢å¹¶å‘é™é¢",
    "prod": "metric",
    "delay": 0,
    "prom_for_duration": 30,
    "rule_config": {
      "queries": [
        {
          "prom_ql": "abs((sum by (instance) (starrocks_fe_connection_total{job=\"jsj-starrocks\"})-sum by (instance) (starrocks_fe_connection_total{job=\"jsj-starrocks\"} offset 3m))/sum by (instance) (starrocks_fe_connection_total{job=\"jsj-starrocks\"})) * 100 > 100",
          "severity": 2,
          "unit": "none"
        }
      ]
    },
    "event_relabel_config": null,
    "prom_eval_interval": 15,
    "enable_in_bg": 0,
    "notify_recovered": 1,
    "notify_repeat_step": 60,
    "notify_max_number": 0,
    "recover_duration": 0,
    "callbacks": [],
    "append_tags": [
      "project=jsj"
    ],
    "annotations": {},
    "uuid": 0,
    "cur_event_count": 0,
    "update_by_nickname": "è¶…ç®¡",
    "cron_pattern": "@every 30s",
    "notify_rule_ids": [
      1
    ],
    "notify_version": 1
  },
  {
    "cate": "prometheus",
    "datasource_queries": [
      {
        "match_type": 0,
        "op": "in",
        "values": [
          1
        ]
      }
    ],
    "name": "é‡‘æ²™æ±Ÿè·¯ StarRocks ç‰©åŒ–è§†å›¾åˆ·æ–°å¼‚å¸¸",
    "note": "é‡‘æ²™æ±Ÿè·¯ StarRocks ç‰©åŒ–è§†å›¾åˆ·æ–°å¼‚å¸¸\n\n**ðŸ“Œ æ£€æµ‹æŒ‡æ ‡ä¿¡æ¯**  \nâ–¸ å®žä¾‹ï¼š`{{$labels.instance}}`  \nâ–¸ æœ€è¿‘å¤±è´¥åˆ·æ–°æ¬¡æ•°ï¼ˆ5 åˆ†é’Ÿï¼‰ï¼š`{{$value}}`  \nâ–¸ è§¦å‘æ¡ä»¶ï¼š5 åˆ†é’Ÿå†…ç‰©åŒ–è§†å›¾åˆ·æ–°å¤±è´¥æ¬¡æ•° > 0\n\n**ðŸ“ é—®é¢˜è¯´æ˜Ž**  \nâœ“ æŸäº›ç‰©åŒ–è§†å›¾åˆ·æ–°å¤±è´¥ï¼Œå¯èƒ½å¯¼è‡´æŸ¥è¯¢ç»“æžœä¸åŠæ—¶æˆ–é”™è¯¯  \nâœ“ å¤±è´¥åŽŸå› å¯èƒ½ä¸ºä»»åŠ¡è°ƒåº¦å¼‚å¸¸ã€ä¾èµ–è¡¨å˜æ›´ã€èµ„æºä¸è¶³ç­‰  \n\n**ðŸ›  å¤„ç†æ–¹æ³•**  \n1ã€æŸ¥çœ‹åˆ·æ–°å¤±è´¥çš„ç‰©åŒ–è§†å›¾ï¼š\nSELECT TABLE_NAME,IS_ACTIVE,INACTIVE_REASON,TASK_NAME FROM information_schema.materialized_views WHERE LAST_REFRESH_STATE !=\" SUCCESS\";\n2ã€å°è¯•æ‰‹åŠ¨åˆ·æ–°è¯¥ç‰©åŒ–è§†å›¾ï¼š\nREFRESH MATERIALIZED VIEW $mv_name;\n3ã€å¦‚æžœç‰©åŒ–è§†å›¾çŠ¶æ€ä¸º INACTIVEï¼Œå¯é€šè¿‡ä»¥ä¸‹æ–¹å¼å°è¯•ç½®ä¸ºæ¿€æ´»ï¼š\nALTER MATERIALIZED VIEW $mv_name ACTIVE;\n4ã€æŽ’æŸ¥åˆ·æ–°å¤±è´¥çš„åŽŸå› ï¼š\nSELECT * FROM information_schema.task_runs WHERE task_name ='mv-112517' \\G\n",
    "prod": "metric",
    "delay": 0,
    "prom_for_duration": 60,
    "rule_config": {
      "queries": [
        {
          "prom_ql": "increase(starrocks_fe_mv_refresh_total_failed_jobs[5m]) > 0",
          "severity": 2,
          "unit": "none"
        }
      ]
    },
    "event_relabel_config": null,
    "prom_eval_interval": 15,
    "enable_in_bg": 0,
    "notify_recovered": 1,
    "notify_repeat_step": 60,
    "notify_max_number": 0,
    "recover_duration": 0,
    "callbacks": [],
    "append_tags": [
      "project=jsj"
    ],
    "annotations": {},
    "uuid": 0,
    "cur_event_count": 0,
    "update_by_nickname": "è¶…ç®¡",
    "cron_pattern": "@every 60s",
    "notify_rule_ids": [
      1
    ],
    "notify_version": 1
  },
  {
    "cate": "prometheus",
    "datasource_queries": [
      {
        "match_type": 0,
        "op": "in",
        "values": [
          1
        ]
      }
    ],
    "name": "é‡‘æ²™æ±Ÿè·¯ StarRocks ç”¨æˆ·è¿žæŽ¥æ•°è¿‡é«˜",
    "note": "é‡‘æ²™æ±Ÿè·¯ StarRocks ç”¨æˆ·è¿žæŽ¥æ•°è¿‡é«˜\n\n**ðŸ“Œ æ£€æµ‹æŒ‡æ ‡ä¿¡æ¯**  \nâ–¸ å½“å‰è¿žæŽ¥æ•°ï¼š`{{$value}}`  \nâ–¸ è§¦å‘æ¡ä»¶ï¼šç”¨æˆ·è¿žæŽ¥æ•°è¶…è¿‡ 100\n\n**ðŸ“ é—®é¢˜è¯´æ˜Ž**  \nâœ“ å½“å‰ç”¨æˆ·è¿žæŽ¥æ•°æŽ¥è¿‘æˆ–è¶…è¿‡é™åˆ¶ï¼Œå¯èƒ½å½±å“ç³»ç»Ÿç¨³å®šæ€§  \nâœ“ é•¿è¿žæŽ¥æœªé‡Šæ”¾æˆ–å®¢æˆ·ç«¯è¿žæŽ¥å¼‚å¸¸ï¼Œå¯èƒ½å¯¼è‡´èµ„æºè€—å°½\n\n**ðŸ›  å¤„ç†å»ºè®®**  \n- é€šè¿‡ `SHOW PROCESSLIST` æŸ¥çœ‹è¿žæŽ¥æ˜Žç»†  \n- ä½¿ç”¨ `KILL` å‘½ä»¤ç»ˆæ­¢æ— æ•ˆè¿žæŽ¥  \n- è°ƒæ•´ `wait_timeout` ç³»ç»Ÿå˜é‡ï¼ˆå¦‚è®¾ä¸º 3600 ç§’ï¼‰æŽ§åˆ¶ç©ºé—²è¿žæŽ¥  \n- å¦‚æœ‰å¿…è¦ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¸´æ—¶æé«˜è¿žæŽ¥ä¸Šé™ï¼š  \n  `ALTER USER 'user' SET PROPERTIES (\"max_user_connections\" = \"1000\");`\n",
    "prod": "metric",
    "delay": 0,
    "prom_for_duration": 60,
    "rule_config": {
      "queries": [
        {
          "prom_ql": "sum by (user) (starrocks_fe_connection_total{job=\"jsj-starrocks\"}) > 100",
          "severity": 2,
          "unit": "none"
        }
      ]
    },
    "event_relabel_config": null,
    "prom_eval_interval": 15,
    "enable_in_bg": 0,
    "notify_recovered": 1,
    "notify_repeat_step": 60,
    "notify_max_number": 0,
    "recover_duration": 0,
    "callbacks": [],
    "append_tags": [
      "project=jsj"
    ],
    "annotations": {},
    "uuid": 0,
    "cur_event_count": 0,
    "update_by_nickname": "è¶…ç®¡",
    "cron_pattern": "@every 60s",
    "notify_rule_ids": [
      1
    ],
    "notify_version": 1
  }
]